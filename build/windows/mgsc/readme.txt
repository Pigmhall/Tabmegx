MGSCWIN.EXE - MGSC for Windows

○概要

MGSCWIN.EXEはMMLを記述したテキストファイルから、MGS形式の音楽データを
生成するコンパイラです。Windows用に新たに作られたコンパイラではなく、
CP/M エミュレータ上でMSX用のMGSC.COM バイナリを直接動作させています。
このため、MSX版MGSC.COMの振る舞いがほぼ完全に再現されています。MMLの文
法についてはMSX版MGSC.COMのドキュメントをご参照下さい。

○使い方

適当なフォルダを作ってMGSCWIN.EXEをコピーしてください。さらに
MGSCWIN.EXE をコピーしたフォルダにMSX用のMGSC.COMをコピーしてください。
これを忘れるとMGSCWIN.EXEが起動しません。

MGSCWIN.EXEはMS-DOSプロンプトもしくは同等の機能を持つコンソールから使用し
ます。コマンドライン書式は次のとおりです。

  MGSCWIN.EXE MMLファイル名 [出力ファイル名] [オプション]

出力ファイル名、オプションは省略可能です。出力ファイル名が省略された場
合、出力ファイル名はMMLファイルの拡張子をMGSに変更したものになります。
出力ファイル名、入力ファイル名共にパスを含む事が可能です。パス指定が無
い場合は、カレントフォルダに対して入出力が行われます。

MGSCWIN.EXEの起動後、入力ファイルにエラーが無ければMGSファイルが生成さ
れます。エラーがあった場合は，エラー情報を表示して終了します。

オプションは -T のみ有効です。このオプションがセットされると、コンパイ
ル後に詳細情報が表示されます。ただし、MMLファイル内に#track_status命令
が記述されている場合は、-T オプション指定の有無にかかわらず、詳細情報
が表示されます。

○ソースについて

MGSCWIN.EXEはC++で記述されています。著者のコンパイル環境はMicrosoft
Visual C++ 6.0 です。添付のソース中，mgscwin.hをインクルードすると，ク
ラスMGSCが利用可能になります．main.cppがMGSCクラスの利用サンプルを兼ね
ているのでご参照ください。基本的には、mml入力用と，ファイル出力用のス
トリームを用意して、

int MGSC::Compile(std::iostream *mml, std::iostream *mgs);

メソッドを呼び出すだけコンパイルができます。

ただし、ファイル入出力ストリームを使用する場合、mml側は入力専用でオー
プンしてかまいませんが、mgs側は入出力用にオープンしておく必要がありま
す。また、両者共にstd::ios::binaryフラグ付きでオープンしてください。こ
れを忘れるとMGSCがMMLの読み込みに失敗します。

Compile関数はCP/Mエミュレータが異常終了した場合falseを返し、正常終了時
はtrueを返します。この値がコンパイル成功失敗の判定では無いことに注意し
てください。コンパイル成功失敗の判定が必要な場合、mgsストリームに書き
込まれたサイズを確認します。コンパイルに失敗した場合，mgsストリームに
は一切書き込みが行われません。

MGSCクラスはコンパイル状況を標準出力に表示しますが、これをユーザーが用
意した出力ストリームに置き換える場合には、

void MGSC::SetConsole(std::istream *cin, std::ostream *cout);

を利用してください。

○著作権等

Z80エミュレーションにMamiya氏作のKMZ80を利用しています。KMZ80はMamiya
氏によりPublic Domain宣言されています。MGSCバイナリおよびソースも
Public Domain宣言します。ソース，バイナリ共に再利用・配布制限は一切あ
りません。連絡等も不要です。

CP/Mエミュレーションに関して、実機のROMイメージ等は一切使用しておりま
せん。

○謝辞

Z80エミュレータKMZ80の作者Mamiya氏に感謝致します。

○参考資料、リンク

MSX-DataPack, ASCII
MGSC.COM, GIGAMIX/Ain氏, http://www.gigamixonline.com/mgsdrv/
KMZ80, Mamiya氏, http://nezplug.sourceforge.net/


○連絡先等

バグ報告はokazaki@angel.ne.jpで受け付けています。ただし、MSX版MGSC.COM
にもともと存在するバグ（もしあれば）の解消や、機能やオプションの追加要
望にはお応えできかねます。悪しからずご了承ください。
  
